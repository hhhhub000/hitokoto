# テスト実行ガイド - ひとこと日記アプリ

このドキュメントでは、新しく追加されたテキスト装飾・絵文字・ASCIIアート機能のテスト実行方法について説明します。

## テスト概要

追加された機能仕様に基づいて、以下のテストカテゴリを作成しました：

### バックエンドテスト
- **ユニットテスト**: テキストバリデーション、装飾処理の個別関数テスト
- **統合テスト**: API エンドポイントの包括的なテスト

### フロントエンドテスト  
- **ユニットテスト**: テキストヘルパー関数、装飾コンポーネントのテスト
- **統合テスト**: ページ全体の機能統合テスト

## テスト実行方法

### バックエンドテスト実行

```powershell
# バックエンドディレクトリに移動
cd backend

# 全テスト実行
npm test

# ウォッチモードでテスト実行
npm run test:watch

# カバレッジレポート付きテスト実行
npm run test:coverage

# ユニットテストのみ実行
npm run test:unit

# 統合テストのみ実行
npm run test:integration

# 装飾機能関連のテストのみ実行
npm run test:decorations

# 詳細なテスト結果表示
npm run test:verbose
```

### フロントエンドテスト実行

```powershell
# フロントエンドディレクトリに移動
cd frontend

# 全テスト実行
npm test

# ウォッチモードでテスト実行
npm run test:watch

# カバレッジレポート付きテスト実行
npm run test:coverage

# ユニットテストのみ実行
npm run test:unit

# 統合テストのみ実行
npm run test:integration

# 装飾機能関連のテストのみ実行
npm run test:decorations

# UIモードでテスト実行（インタラクティブ）
npm run test:ui
```

## テストファイル構成

```
backend/src/__tests__/
├── unit/
│   ├── textValidation.test.ts      # テキストバリデーション関数のテスト
│   └── setup/
│       └── testSetup.test.ts       # テスト環境とヘルパーのテスト
└── integration/
    └── diaryApi.test.ts            # API統合テスト

frontend/src/__tests__/
├── unit/
│   ├── textHelpers.test.ts         # テキストヘルパー関数のテスト
│   └── TextDecorationComponents.test.tsx  # 装飾コンポーネントのテスト
├── integration/
│   └── DiaryPages.test.tsx         # ページ統合テスト
└── setup/
    └── testSetup.ts                # フロントエンドテスト環境設定
```

## テスト対象機能

### 1. テキスト装飾機能
- ✅ 太字（`<b>text</b>`）装飾のテスト
- ✅ 斜体（`<i>text</i>`）装飾のテスト  
- ✅ 下線（`<u>text</u>`）装飾のテスト
- ✅ 取り消し線（`<s>text</s>`）装飾のテスト
- ✅ カラー装飾のテスト
- ✅ フォントサイズ装飾のテスト
- ✅ 複合装飾の組み合わせテスト

### 2. 絵文字機能
- ✅ 感情絵文字（😊😢😠😲など）の選択・挿入テスト
- ✅ 天気絵文字（☀️☔☁️❄️など）の選択・挿入テスト
- ✅ 活動絵文字（💼📚⚽🎵など）の選択・挿入テスト
- ✅ 食べ物絵文字（☕🍰🍕🍎など）の選択・挿入テスト
- ✅ 絵文字ショートコード（`:smile:` → 😊）の変換テスト
- ✅ 絵文字検索・フィルタリング機能のテスト

### 3. ASCIIアート機能
- ✅ 嬉しい顔文字（٩(◕‿◕)۶など）の選択・挿入テスト
- ✅ クールな顔文字（(⌐■_■)など）の選択・挿入テスト
- ✅ 日本の顔文字（＼(＾o＾)／など）の選択・挿入テスト
- ✅ ASCIIアートのカテゴリ分類テスト
- ✅ ASCIIアートの検出・判定テスト

### 4. バリデーション機能
- ✅ 140文字制限（装飾タグを含む）のテスト
- ✅ 空文字・空白のみのテキストの拒否テスト
- ✅ 装飾付きテキストのバリデーションテスト
- ✅ 絵文字・ASCIIアート含有テキストのバリデーションテスト

### 5. API統合機能
- ✅ 装飾付きテキストでの日記作成APIテスト
- ✅ 絵文字付きテキストでの日記作成APIテスト
- ✅ ASCIIアート付きテキストでの日記作成APIテスト
- ✅ 画像アップロード + 装飾テキストの組み合わせテスト
- ✅ 日記編集・更新時の装飾保持テスト

### 6. UI/UX機能
- ✅ テキスト装飾ツールバーの動作テスト
- ✅ 絵文字ピッカーの動作テスト
- ✅ ASCIIアートピッカーの動作テスト
- ✅ リアルタイム文字数カウンターのテスト
- ✅ プレビュー機能でのHTML装飾表示テスト
- ✅ 検索機能での装飾テキスト検索テスト

## テスト実行前の準備

### 1. 依存関係のインストール

```powershell
# バックエンド
cd backend
npm install

# フロントエンド
cd frontend  
npm install
```

### 2. テスト用画像ファイルの準備
統合テストでは画像アップロード機能をテストするため、テスト実行時に自動的に小さなテスト用画像ファイルが作成されます。

### 3. モックの設定確認
- API呼び出し、ファイルアップロード、DOM操作などは適切にモック化されています
- テスト実行時に実際のサーバー起動や外部リソースへのアクセスは必要ありません

## エラー解決

### よくあるエラーと解決方法

1. **TypeScript関連のエラー**
   ```powershell
   # 型定義ファイルが見つからない場合
   npm install --save-dev @types/jest @types/supertest
   ```

2. **モジュール解決エラー**
   ```powershell
   # Node.jsの設定を確認
   node --version  # v18以上推奨
   npm --version   # v9以上推奨
   ```

3. **テストタイムアウト**
   - 統合テストでタイムアウトが発生する場合、Jest設定の`testTimeout`を増加させてください

## カバレッジ目標

- **関数カバレッジ**: 80%以上
- **行カバレッジ**: 80%以上
- **分岐カバレッジ**: 80%以上
- **文カバレッジ**: 80%以上

## 継続的改善

### テスト追加が必要な場合
1. `docs/specifications.md`に新機能の仕様を追記
2. 該当するテストファイルに新しいテストケースを追加
3. 必要に応じてモックやヘルパー関数を拡張
4. テスト実行でカバレッジを確認

### テスト品質の維持
- 新機能追加時は必ずテスト作成を先行させる（TDD）
- 仕様変更時はテストも同時に更新する
- 定期的にテストカバレッジレポートを確認する
- フレイキー（不安定）なテストは即座に修正する

---

**注意**: これらのテストは新しく追加された仕様（v1.1）に基づいて作成されています。実際のコンポーネントやAPI実装が完了した後に、テスト内のimport文やモック設定を適切に調整する必要があります。