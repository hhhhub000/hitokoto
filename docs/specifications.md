# ひとこと日記 Webアプリ 仕様書

## 1. 概要
本仕様書は「ひとこと日記」Webアプリケーションの技術仕様を定義するものです。

## 2. 技術スタック
- **フロントエンド**: React 18 + TypeScript + Vite + Tailwind CSS + Zustand
- **バックエンド**: Node.js + Express + TypeScript
- **ファイル管理**: Multer (画像アップロード)
- **データベース**: モックデータサービス（メモリ内）

## 3. UI（画面）

### 3.1 投稿画面 (`/create`, `/edit/:id`)
**実装状況**: ✅ 完了
- 日記投稿フォームの表示
- テキスト入力エリア（140文字制限、リアルタイム文字数表示）
- 写真アップロード機能（プレビュー表示）
- バリデーション（必須入力チェック、文字数制限）
- 投稿・更新・キャンセルボタン

### 3.2 一覧画面 (`/`)
**実装状況**: ✅ 完了
- 投稿済み日記の表示（カード形式）
- 新しい順でのソート表示
- ページネーション（10件/ページ）
- 日記がない場合の空状態表示
- 各日記への編集・削除・詳細リンク

### 3.3 詳細画面 (`/diary/:id`)
**実装状況**: ✅ 完了
- 個別日記の詳細表示
- 編集・削除ボタン
- 一覧への戻るリンク
- 投稿日時の表示

### 3.4 レイアウト・ナビゲーション
**実装状況**: ✅ 完了
- ヘッダーナビゲーション
- レスポンシブデザイン（Tailwind CSS）
- ページ間の画面遷移（React Router）

## 4. 日記の投稿機能

### 4.1 テキスト投稿
**実装状況**: ✅ 完了
- 140文字以内のテキスト入力
- リアルタイム文字数カウント
- 必須入力バリデーション

### 4.2 テキスト装飾機能
**実装状況**: 📋 未実装（計画中）

#### 4.2.1 文字装飾ボタン
- **太字（Bold）**: `**text**` or `<b>text</b>`
- **斜体（Italic）**: `*text*` or `<i>text</i>`
- **下線（Underline）**: `<u>text</u>`
- **取り消し線（Strike）**: `~~text~~` or `<s>text</s>`
- **カラー**: プリセットカラーパレット（赤、青、緑、黄、紫等）
- **フォントサイズ**: 小・中・大の3段階選択

#### 4.2.2 装飾UI仕様
- **ツールバー配置**: テキストエリア上部に横並び配置
- **アクティブ状態**: 選択中の装飾ボタンはハイライト表示
- **プレビュー機能**: リアルタイムで装飾結果を表示
- **ショートカット**: Ctrl+B（太字）、Ctrl+I（斜体）等対応
- **レスポンシブ**: モバイルでもタップしやすいボタンサイズ

#### 4.2.3 実装方式
- **フロントエンド**: Rich Text Editor（Quill.js または独自実装）
- **データ保存**: HTML形式またはMarkdown形式で保存
- **表示**: サニタイズ処理を経た安全なHTML表示
- **後方互換**: 既存のプレーンテキストもサポート

### 4.3 絵文字・アスキーアート機能
**実装状況**: 📋 未実装（計画中）

#### 4.3.1 絵文字選択機能
- **絵文字パネル**: ポップアップ形式の絵文字ピッカー
- **カテゴリ分類**: 感情、天気、食べ物、活動、記号等
- **検索機能**: 絵文字名での検索（「笑顔」「雨」等）
- **最近使用**: よく使う絵文字の履歴表示
- **Unicode対応**: 標準的な絵文字（😀😃😄😁等）をサポート

#### 4.3.2 絵文字UI仕様
- **起動ボタン**: テキストエリア横に😀アイコンボタン配置
- **パネルサイズ**: 300x200px、最大50個の絵文字を表示
- **選択方法**: クリック/タップでテキストエリアに挿入
- **レスポンシブ**: モバイルではフルスクリーン表示も対応

#### 4.3.3 アスキーアート機能
- **プリセット集**: 事前定義されたアスキーアート集
  ```
  ٩(◕‿◕)۶    # 喜び
  (╯°□°)╯    # 怒り  
  ¯\_(ツ)_/¯  # 困惑
  (｡◕‿◕｡)    # 笑顔
  (⌐■_■)     # クール
  ```
- **カテゴリ分類**: 感情、動物、記号、季節等
- **カスタム機能**: ユーザー独自のアスキーアート登録
- **プレビュー**: 選択前にプレビュー表示

#### 4.3.4 アスキーアートUI仕様
- **起動ボタン**: テキストエリア横に (ﾟ∀ﾟ) アイコンボタン配置
- **選択パネル**: ドロップダウンまたはモーダル形式
- **検索・フィルタ**: カテゴリ別表示、キーワード検索
- **ワンクリック挿入**: 選択と同時にテキストエリアに挿入

#### 4.3.5 技術仕様
- **データ構造**: 
  ```typescript
  interface EmojiData {
    unicode: string;
    name: string;
    category: string;
    keywords: string[];
  }
  
  interface AsciiArt {
    id: string;
    art: string;
    category: string;
    name: string;
    description?: string;
  }
  ```
- **ストレージ**: 最近使用した絵文字・アスキーアートをlocalStorageに保存
- **パフォーマンス**: 遅延読み込み、仮想スクロール対応

### 4.4 入力支援機能
**実装状況**: 📋 未実装（計画中）

#### 4.4.1 テンプレート機能
- **定型文**: 「今日は〇〇でした」「お疲れ様！」等
- **天気テンプレート**: 晴れ☀️、雨☔、曇り☁️等の組み合わせ
- **感情テンプレート**: 嬉しい、悲しい、怒り等の表現セット

#### 4.4.2 予測変換・補完
- **過去投稿学習**: ユーザーの過去の投稿パターンを学習
- **一般的フレーズ**: よく使われる日記表現の候補表示
- **日付・時間**: 「今日」「昨日」「先週」等の自動変換

### 4.5 写真アップロード
**実装状況**: ✅ 完了
- 画像ファイルのアップロード（JPEG, PNG, GIF対応）
- 最大ファイルサイズ: 5MB
- 画像プレビュー機能
- ファイル形式・サイズのバリデーション

### 4.6 バリデーション
**実装状況**: ✅ 完了
- フロントエンド: 即座入力チェック
- バックエンド: サーバーサイドバリデーション
- エラーメッセージの表示

## 5. 日記の一覧表示機能

### 5.1 一覧取得
**実装状況**: ✅ 完了
- 投稿済み日記の取得・表示
- 新しい順でのソート
- ページネーション対応

### 5.2 検索・フィルタ
**実装状況**: 🔄 部分実装（バックエンドのみ）
- キーワード検索（テキスト内容）
- 日付範囲での絞り込み
- **TODO**: フロントエンドUI実装予定

### 5.3 操作機能
**実装状況**: ✅ 完了
- 編集機能（テキストのみ）
- 削除機能（確認ダイアログ付き）
- 詳細表示

## 6. データベース機能

### 6.1 データモデル
**実装状況**: ✅ 完了
```typescript
interface Diary {
  id: string;          // UUID
  text: string;        // 140文字以内
  imageUrl?: string;   // 画像ファイルパス（任意）
  createdAt: Date;     // 作成日時
  updatedAt: Date;     // 更新日時
}
```

### 6.2 CRUD操作
**実装状況**: ✅ 完了
- **CREATE**: `POST /api/diaries` - 新規日記作成
- **READ**: `GET /api/diaries` - 一覧取得, `GET /api/diaries/:id` - 個別取得
- **UPDATE**: `PUT /api/diaries/:id` - 日記更新
- **DELETE**: `DELETE /api/diaries/:id` - 日記削除

### 6.3 ファイル管理
**実装状況**: ✅ 完了
- 画像ファイルの保存（`/uploads`ディレクトリ）
- ユニークファイル名生成（UUID）
- ファイル配信（静的ファイル提供）

## 7. API仕様

### 7.1 エンドポイント一覧
| メソッド | エンドポイント | 説明 | 実装状況 |
|---------|---------------|------|----------|
| GET | `/api/diaries` | 日記一覧取得 | ✅ |
| GET | `/api/diaries/:id` | 個別日記取得 | ✅ |
| POST | `/api/diaries` | 日記作成 | ✅ |
| PUT | `/api/diaries/:id` | 日記更新 | ✅ |
| DELETE | `/api/diaries/:id` | 日記削除 | ✅ |

### 7.2 リクエスト・レスポンス形式
**共通レスポンス形式**:
```typescript
interface ApiResponse<T> {
  success: boolean;
  data?: T;
  error?: string;
  message?: string;
}
```

## 8. 状態管理

### 8.1 Zustand Store
**実装状況**: ✅ 完了
- 日記データの一元管理
- API呼び出しの抽象化
- ローディング・エラー状態の管理
- ページネーション状態の管理

## 9. 今後の拡張予定

### 9.1 フロントエンド機能
- [ ] 検索・フィルタUI
- [ ] **テキスト装飾機能** - 太字、斜体、カラー、サイズ変更等
- [ ] **絵文字選択パネル** - カテゴリ別絵文字ピッカー
- [ ] **アスキーアート機能** - プリセット・カスタムアスキーアート
- [ ] **入力支援機能** - テンプレート、予測変換、定型文
- [ ] **リッチテキストエディタ** - WYSIWYG編集機能
- [ ] 画像のリサイズ・圧縮
- [ ] PWA対応
- [ ] ダークモード

### 9.2 バックエンド機能
- [ ] 実際のデータベース接続（SQLite/PostgreSQL）
- [ ] ユーザー認証
- [ ] 画像の最適化処理
- [ ] バックアップ機能

### 9.3 テスト
- [ ] ユニットテスト（Jest）
- [ ] 統合テスト
- [ ] E2Eテスト

---

**作成日**: 2025年9月28日  
**バージョン**: 1.1  
**最終更新**: 2025年9月28日 - テキスト装飾・絵文字・アスキーアート機能仕様追加